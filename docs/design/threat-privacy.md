# Threat & Privacy Analysis

---

## 1. 개요

본 시스템은 대학생 대상 연구 플랫폼으로, 개인 식별 정보 최소화 원칙을 적용합니다.

---

## 2. 데이터 수집 범위

| 수집 데이터 | 저장 방식 | 개인정보 포함 여부 |
|---|---|---|
| 사용자 역할/숙련도 | `users_anon` (UUID) | ❌ 익명 |
| 학습 맥락 (goal/stack/constraints) | `contexts` | ❌ 비식별 |
| 질문 텍스트 | SHA-256 해시만 저장 | ❌ 원문 미저장 |
| LLM 답변 | `candidates.answer_summary` | ❌ 생성 답변 |
| 피드백 선호도 | `feedback_pairwise.user_choice` | ❌ 선택값만 |
| 피드백 메모 | `feedback_pairwise.note` | ⚠️ 자유 입력 (개인정보 가능성) |

---

## 3. 위협 분석

### T-01. DB 연결 정보 노출
- **위협**: `.env` 파일의 `DB_URL` 노출 시 DB 직접 접근 가능
- **대응**:
  - `.env` gitignore 처리 (버전 관리 제외)
  - `find_dotenv()` 기반 로컬 파일 탐색 (환경 분리)
  - 프로덕션 환경에서는 시크릿 매니저(AWS Secrets Manager 등) 사용 권장

### T-02. OpenAI API Key 노출
- **위협**: `OPENAI_API_KEY` 노출 시 무단 API 사용 및 과금 발생
- **대응**:
  - `.env` gitignore 처리
  - API Key를 로그/응답에 포함하지 않음
  - `openai_engine.py`: 빈 키 → error EngineResult 반환 (예외 미전파)

### T-03. LLM 프롬프트 인젝션
- **위협**: 사용자 질문에 악의적 지시문 삽입으로 LLM 동작 왜곡
- **대응**:
  - `build_prompts_v1()`: system 프롬프트와 user 프롬프트 분리
  - system 프롬프트로 역할/맥락 고정
  - 현재 프로토타입 수준에서는 추가 필터링 미적용 (향후 강화 필요)

### T-04. 익명성 우회
- **위협**: 피드백 `note` 자유 기술 필드에 개인정보 입력 가능
- **대응**:
  - 연구 참여 안내 시 개인정보 미기재 지침 제공
  - 향후 필터링 또는 검토 프로세스 추가 권장

### T-05. SQL 인젝션
- **위협**: ORM 우회 시 악의적 SQL 실행
- **대응**:
  - SQLAlchemy ORM 사용 (파라미터 바인딩 자동 처리)
  - `ranker.py`의 raw SQL도 `text()` + 파라미터 바인딩 사용

### T-06. 모델 아티팩트 위변조
- **위협**: `.pkl` 파일 교체로 LTR 선택 결과 조작
- **대응**:
  - `artifact_path` → DB에 등록된 경로만 사용
  - 파일 시스템 접근 제어 (운영 환경 별도 설정 필요)
  - `model_version` + `feature_version` 추적으로 감사 가능

### T-07. API 무단 접근
- **위협**: 인증 없이 API 호출로 데이터 수집/변조
- **대응**:
  - 현재 프로토타입: 인증 미적용 (로컬 개발 환경)
  - 파일럿 실험 범위 내에서 네트워크 접근 제어로 대체
  - 프로덕션 전환 시 인증/인가 레이어 추가 필요

---

## 4. 개인정보 보호 원칙

| 원칙 | 적용 방식 |
|---|---|
| 최소 수집 | user_id = UUID만 사용, 이름/이메일 미수집 |
| 익명화 | `users_anon` 테이블 (식별자 없음) |
| 원문 미저장 | 질문 텍스트 → SHA-256 해시만 보관 |
| 데이터 분리 | 연구 목적 데이터와 시스템 로그 분리 |

---

## 5. 향후 개선 필요 사항

- [ ] API 인증/인가 (JWT 또는 API Key 기반)
- [ ] `note` 필드 개인정보 필터링
- [ ] LLM 프롬프트 인젝션 방어 강화
- [ ] `.pkl` 모델 파일 무결성 검증 (해시 체크)
- [ ] 시크릿 관리 시스템 연동
